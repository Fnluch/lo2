<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>浪漫表白 - 照片墙 & 爱心烟花</title>
    <style>
        html, body {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            overflow: hidden;
            background: #121212;
            font-family: '微软雅黑', sans-serif;
            color: white;
            position: relative;
            user-select: none;
        }
        #blur-bg {
            position: fixed;
            top:0; left:0; right:0; bottom:0;
            background: rgba(40,40,40,0.4);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            z-index: 0;
            opacity: 1;
            transition: opacity 1s ease;
        }
        #slideshow {
            position: relative;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            transition: opacity 1s ease;
        }
        .slide {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 38vw;
            height: 38vh;
            background-size: cover;
            background-position: center center;
            border-radius: 1vw;
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
            opacity: 0.85;
            transition: transform 1.2s ease, opacity 1.2s ease;
            transform-origin: center center;
            user-select: none;
            /* 默认居中 */
            transform: translate(-50%, -50%);
        }
        #heart-canvas, #fireworks-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 15;
            opacity: 0;
            transition: opacity 1s ease;
            background: transparent !important;
        }
        #message {
            position: fixed;
            z-index: 20;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90vw;
            color: white;
            text-align: center;
            opacity: 0;
            transition: opacity 1.5s ease;
            user-select: none;
        }
        #heart-container {
            margin: 0 auto;
            width: 20vw;
            height: 18vw;
            filter: drop-shadow(0 0 10px crimson);
            animation: heartBeat 1.4s ease-in-out infinite;
        }
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.25); }
        }
        #text {
            font-size: 5vw;
            margin-top: 2vw;
            max-width: 80vw;
            text-shadow: 0 0 8px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.25);
            padding: 3vw;
            border-radius: 1.5vw;
            line-height: 1.4;
        }
    </style>
</head>
<body>
<div id="blur-bg"></div>

<div id="slideshow">
    <!-- 替换为你自己的图片 -->
    <div class="slide" style="background-image: url('p/2.jpg');"></div>
    <div class="slide" style="background-image: url('p/3.JPG');"></div>
    <div class="slide" style="background-image: url('p/4.JPG');"></div>
    <div class="slide" style="background-image: url('p/5.JPG');"></div>
    <div class="slide" style="background-image: url('p/6.JPG');"></div>
    <div class="slide" style="background-image: url('p/7.JPG');"></div>
    <div class="slide" style="background-image: url('p/8.JPG');"></div>
    <div class="slide" style="background-image: url('p/9.jpg');"></div>
    <div class="slide" style="background-image: url('p/10.jpg');"></div>
    <div class="slide" style="background-image: url('p/11.jpg');"></div>
    <div class="slide" style="background-image: url('p/12.JPG');"></div>
    <div class="slide" style="background-image: url('p/13.jpg');"></div>
    <div class="slide" style="background-image: url('p/14.jpg');"></div>
    <div class="slide" style="background-image: url('p/15.jpg');"></div>
    <div class="slide" style="background-image: url('p/16.jpg');"></div>
    <div class="slide" style="background-image: url('p/17.jpg');"></div>
    <div class="slide" style="background-image: url('p/18.jpg');"></div>
    <div class="slide" style="background-image: url('p/19.jpg');"></div>
</div>

<canvas id="heart-canvas"></canvas>
<canvas id="fireworks-canvas"></canvas>

<div id="message">
    <div id="heart-container" style="opacity: 0;">
        <svg viewBox="0 0 512 512" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" >
            <defs>
                <radialGradient id="grad" cx="50%" cy="50%" r="70%">
                    <stop offset="0%" stop-color="#FF5F6D"/>
                    <stop offset="50%" stop-color="#FFC371"/>
                    <stop offset="100%" stop-color="#FF5F6D" stop-opacity="0"/>
                </radialGradient>
                <filter id="glow" x="-50%" y="-50%" width="200%" height="200%" >
                    <feDropShadow dx="0" dy="0" stdDeviation="6" flood-color="#FF5F6D" flood-opacity="0.7"/>
                </filter>
            </defs>
            <path filter="url(#glow)" fill="url(#grad)" stroke="#FF2A68" stroke-width="10"
                  d="M471.7 73.7c-54-30-121-7-148 40-27-47-94-70-148-40-67 37-70 120-30 176 37 52 131 136 178 176 47-40 141-124 178-176 40-56 37-139-30-176z"/>
        </svg>
    </div>
    <div id="text" style="opacity: 0;">
        <h1>喜欢你</h1>
        <p>我是小学生李贵银，我喜欢小学生宋一鸣</p>
    </div>
</div>

<script>
    // 基本变量
    const slides = document.querySelectorAll(".slide");
    const blurBg = document.getElementById("blur-bg");
    const slideshow = document.getElementById("slideshow");
    const heartCanvas = document.getElementById("heart-canvas");
    const fireworksCanvas = document.getElementById("fireworks-canvas");
    const heartCtx = heartCanvas.getContext("2d");
    const fireworksCtx = fireworksCanvas.getContext("2d");
    const message = document.getElementById("message");
    const heartContainer = document.getElementById("heart-container");
    const textBlock = document.getElementById("text");

    let cw, ch;
    function resize() {
        cw = window.innerWidth;
        ch = window.innerHeight;
        heartCanvas.width = cw;
        heartCanvas.height = ch;
        fireworksCanvas.width = cw;
        fireworksCanvas.height = ch;
    }
    window.addEventListener("resize", resize);
    resize();

    // 工具函数
    function randomRange(min, max) { return Math.random() * (max - min) + min; }

    // 照片墙散开动画
    function scatterSlides() {
        slides.forEach((slide, i) => {
            // 计算分布区域，保证不重叠过多，分散在屏幕中间一定范围内
            const angle = (i / slides.length) * 2 * Math.PI;
            const radiusX = 18 + randomRange(-3, 3);
            const radiusY = 14 + randomRange(-2, 2);
            const x = Math.cos(angle) * radiusX + randomRange(-3, 3);
            const y = Math.sin(angle) * radiusY + randomRange(-2, 2);
            const scale = randomRange(0.55, 0.9);
            const rotate = randomRange(-20, 20);
            slide.style.transition = 'transform 1.2s ease, opacity 1.2s ease';
            slide.style.transform = `translate(-50%, -50%) translate(${x}vw, ${y}vh) scale(${scale}) rotate(${rotate}deg)`;
            slide.style.opacity = randomRange(0.75, 1);
            slide.style.zIndex = 100 + i; // 保持层次稳定，避免闪烁
        });
    }

    scatterSlides();
    let scatterInterval = setInterval(scatterSlides, 1000);

    // -----------------------------------
    // 爱心粒子相关
    class HeartParticle {
        constructor() {
            this.x = Math.random() * cw;
            this.y = ch + 20;
            this.size = randomRange(10, 18);
            this.speedY = randomRange(-1.1, -0.7);
            this.speedX = (Math.random() - 0.5) * 0.4;
            this.opacity = 1;
            this.fadeRate = randomRange(0.005, 0.012);
            this.angle = Math.random() * Math.PI * 2;
            this.spinSpeed = (Math.random() - 0.5) * 0.03;
            this.sizeDirection = 1;
            this.sizeChangeSpeed = randomRange(0.01, 0.02);
            this.baseSize = this.size;
        }
        draw(ctx) {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            const gradient = ctx.createRadialGradient(0, 0, this.size*0.3, 0, 0, this.size);
            gradient.addColorStop(0, `rgba(255, 95, 109, ${this.opacity})`);
            gradient.addColorStop(0.6, `rgba(255, 195, 113, ${this.opacity*0.5})`);
            gradient.addColorStop(1, `rgba(255, 95, 109, 0)`);
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(0, 0, this.size*0.8, 0, Math.PI*2);
            ctx.fill();

            ctx.fillStyle = `rgba(255, 95, 109, ${this.opacity})`;
            ctx.shadowColor = `rgba(255, 95, 109, ${this.opacity*0.7})`;
            ctx.shadowBlur = 10;

            // 简单爱心路径
            const s = this.size / 20;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(0, -3*s, -5*s, -15*s, -10*s, -15*s);
            ctx.bezierCurveTo(-20*s, -15*s, -20*s, 0, -20*s, 0);
            ctx.bezierCurveTo(-20*s, 10*s, -10*s, 15*s, 0, 25*s);
            ctx.bezierCurveTo(10*s, 15*s, 20*s, 10*s, 20*s, 0);
            ctx.bezierCurveTo(20*s, 0, 20*s, -15*s, 10*s, -15*s);
            ctx.bezierCurveTo(5*s, -15*s, 0, -3*s, 0, 0);
            ctx.closePath();
            ctx.fill();

            ctx.restore();
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.angle += this.spinSpeed;
            this.opacity -= this.fadeRate;
            if (this.opacity < 0) this.opacity = 0;

            if(this.size >= this.baseSize*1.25) this.sizeDirection = -1;
            if(this.size <= this.baseSize*0.75) this.sizeDirection = 1;
            this.size += this.sizeChangeSpeed * this.sizeDirection;
        }
    }

    // -----------------------------------
    // 烟花相关
    class Firework {
        constructor(sx, sy, tx, ty) {
            this.x = sx;
            this.y = sy;
            this.sx = sx;
            this.sy = sy;
            this.tx = tx;
            this.ty = ty;
            this.distanceToTarget = dist(sx, sy, tx, ty);
            this.distanceTraveled = 0;
            this.coordinates = [];
            this.coordinateCount = 3;
            while(this.coordinateCount--) {
                this.coordinates.push([this.x, this.y]);
            }
            this.angle = Math.atan2(ty - sy, tx - sx);
            this.speed = 4;
            this.acceleration = 1.05;
            this.brightness = randomRange(50, 70);
            this.targetRadius = 1;
        }
        update(index) {
            this.coordinates.pop();
            this.coordinates.unshift([this.x, this.y]);
            if(this.targetRadius < 8) {
                this.targetRadius += 0.3;
            } else {
                this.targetRadius = 1;
            }
            this.speed *= this.acceleration;
            let vx = Math.cos(this.angle) * this.speed;
            let vy = Math.sin(this.angle) * this.speed;
            this.distanceTraveled = dist(this.sx, this.sy, this.x + vx, this.y + vy);
            if(this.distanceTraveled >= this.distanceToTarget) {
                createParticles(this.tx, this.ty);
                fireworks.splice(index, 1);
            } else {
                this.x += vx;
                this.y += vy;
            }
        }
        draw(ctx) {
            ctx.beginPath();
            ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
            ctx.lineTo(this.x, this.y);
            ctx.strokeStyle = `hsl(${this.brightness}, 100%, 70%)`;
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
            ctx.stroke();
        }
    }
    class Particle {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.coordinates = [];
            this.coordinateCount = 5;
            while(this.coordinateCount--) {
                this.coordinates.push([this.x, this.y]);
            }
            this.angle = randomRange(0, Math.PI * 2);
            this.speed = randomRange(2, 10);
            this.friction = 0.95;
            this.gravity = 0.4;
            this.hue = randomRange(0, 360);
            this.brightness = randomRange(50, 80);
            this.alpha = 1;
            this.decay = randomRange(0.015, 0.03);
        }
        update(index) {
            this.coordinates.pop();
            this.coordinates.unshift([this.x, this.y]);
            this.speed *= this.friction;
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed + this.gravity;
            this.alpha -= this.decay;
            if(this.alpha <= 0) {
                particles.splice(index, 1);
            }
        }
        draw(ctx) {
            ctx.beginPath();
            ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
            ctx.lineTo(this.x, this.y);
            ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
            ctx.stroke();
        }
    }
    function dist(aX, aY, bX, bY) {
        const x = bX - aX;
        const y = bY - aY;
        return Math.sqrt(x * x + y * y);
    }
    function createParticles(x, y) {
        let particleCount = 30;
        while(particleCount--) {
            particles.push(new Particle(x, y));
        }
    }

    // 大爱心轮廓点采样（SVG心形参数）
    function getHeartPoints(centerX, centerY, scale, pointsCount = 100) {
        const pts = [];
        for(let i = 0; i < pointsCount; i++) {
            let t = (i / pointsCount) * 2 * Math.PI;
            let x = 16 * Math.pow(Math.sin(t), 3);
            let y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
            pts.push({
                x: centerX + scale * x,
                y: centerY - scale * y
            });
        }
        return pts;
    }

    // 大爱心外围渐显粒子类
    class OutlineHeartParticle {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.opacity = 0;
            this.size = 6 + Math.random() * 6;
            this.maxOpacity = 0.9;
            this.fadeInSpeed = 0.03 + Math.random() * 0.03;
            this.life = 100 + Math.random() * 100;
        }
        update() {
            if(this.opacity < this.maxOpacity && this.life > 0) {
                this.opacity += this.fadeInSpeed;
                if(this.opacity > this.maxOpacity) this.opacity = this.maxOpacity;
            }
            this.life--;
            if(this.life <= 0) {
                this.opacity -= this.fadeInSpeed * 1.5;
                if(this.opacity < 0) this.opacity = 0;
            }
        }
        draw(ctx) {
            if(this.opacity <= 0) return;
            ctx.beginPath();
            let gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
            gradient.addColorStop(0, `rgba(255, 95, 109, ${this.opacity})`);
            gradient.addColorStop(1, `rgba(255, 95, 109, 0)`);
            ctx.fillStyle = gradient;
            ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
            ctx.fill();
        }
    }

    // 动画主流程变量
    let heartParticles = [];
    let fireworks = [];
    let particles = [];
    let outlineParticles = [];

    // 初始化外围爱心轮廓粒子
    let heartPts = getHeartPoints(cw/2, ch/2, 15);
    for(let pt of heartPts) {
        outlineParticles.push(new OutlineHeartParticle(pt.x, pt.y));
    }

    // 爱心粒子动画
    function animateHearts() {
        heartCtx.clearRect(0, 0, cw, ch);
        // 绘制外围轮廓粒子
        for(let i = outlineParticles.length - 1; i >= 0; i--) {
            outlineParticles[i].update();
            outlineParticles[i].draw(heartCtx);
            if(outlineParticles[i].opacity <= 0 && outlineParticles[i].life <= 0) {
                outlineParticles.splice(i, 1);
            }
        }
        // 新增和更新上升心形粒子
        if(heartParticles.length < 40) {
            heartParticles.push(new HeartParticle());
        }
        for(let i = heartParticles.length - 1; i >= 0; i--) {
            heartParticles[i].update();
            heartParticles[i].draw(heartCtx);
            if(heartParticles[i].opacity <= 0) {
                heartParticles.splice(i, 1);
            }
        }
    }

    // 烟花动画
    function animateFireworks() {
        fireworksCtx.clearRect(0, 0, cw, ch);
        // 控制烟花数量，发射位置随机
        if(fireworks.length < 3) {
            let sx = randomRange(cw*0.3, cw*0.7);
            let sy = ch + 20;
            let tx = randomRange(cw*0.3, cw*0.7);
            let ty = randomRange(ch*0.15, ch*0.55);
            fireworks.push(new Firework(sx, sy, tx, ty));
        }
        for(let i = fireworks.length - 1; i >= 0; i--) {
            fireworks[i].update(i);
            fireworks[i].draw(fireworksCtx);
        }
        for(let i = particles.length - 1; i >= 0; i--) {
            particles[i].update(i);
            particles[i].draw(fireworksCtx);
        }
    }

    // 播放阶段控制
    let stage = 0;

    function runStage() {
        if(stage === 0) {
            // 照片墙阶段
            blurBg.style.opacity = "1";
            slideshow.style.opacity = "1";
            heartCanvas.style.opacity = "0";
            fireworksCanvas.style.opacity = "0";
            message.style.opacity = "0";
            heartContainer.style.opacity = "0";
            textBlock.style.opacity = "0";
        } else if(stage === 1) {
            // 爱心和烟花显示阶段
            clearInterval(scatterInterval);
            blurBg.style.opacity = "0.2";
            slideshow.style.opacity = "0";
            heartCanvas.style.opacity = "1";
            fireworksCanvas.style.opacity = "1";
            message.style.opacity = "1";
            heartContainer.style.opacity = "1";
            textBlock.style.opacity = "1";
        } else if(stage === 2) {
            // 结束所有显示，或者你可以加入更多环节
            heartCanvas.style.opacity = "0";
            fireworksCanvas.style.opacity = "0";
            message.style.opacity = "0";
            heartContainer.style.opacity = "0";
            textBlock.style.opacity = "0";
        }
    }

    // 初始阶段，开始散开动画
    runStage();

    // 10秒后切换到爱心烟花阶段
    setTimeout(() => {
        stage = 1;
        runStage();
    }, 10000);

    // 动画循环
    function loop() {
        if(stage === 1) {
            animateHearts();
            animateFireworks();
        }
        requestAnimationFrame(loop);
    }
    loop();

</script>
</body>
</html>
